<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PlayCanvas Hello Cube</title>
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no' />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="viewport-fit=cover, user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
    <script src='./engine.js'></script>
</head>
<body>
    <canvas id='application'></canvas>
    <script>
        // create a PlayCanvas application
        const canvas = document.getElementById('application');
        canvas.style['-webkit-user-select'] = 'none';
        const app = new pc.Application(canvas, {
            elementInput: new pc.ElementInput(canvas),
            mouse: new pc.Mouse(canvas),
            touch: !!('ontouchstart' in window) ? new pc.TouchDevice(canvas) : null,
            keyboard: new pc.Keyboard(window),
        });

        var device = pc.Application.getApplication().graphicsDevice;
        device.maxPixelRatio = window.devicePixelRatio;

        // fill the available space at full resolution
        app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);
        app.setCanvasResolution(pc.RESOLUTION_AUTO);

        // ensure canvas is resized when window changes size
        window.addEventListener('resize', () => app.resizeCanvas());

        var targetBarProgress = 0;
        var barProgress = 0;

        // create box entity
        const plane = new pc.Entity('plane');
        plane.addComponent('model', {
            type: 'plane'
        });
        app.root.addChild(plane);
        plane.setEulerAngles(90,0,0);

        var mat = new pc.BasicMaterial();
        mat.color.set(0.76,1,0.5);
        plane.model.material = mat;

        // add script
        app.assets.loadFromUrl("./barScript.js", "script", function (err, asset) {
            //var texture = asset.resource;
            plane.addComponent("script");
            plane.script.create("barScript");
        });

        // create UI
        const ui = new pc.Entity('cam_ui');
        ui.addComponent('screen', {
            referenceResolution: new pc.Vec2(1280, 720),
            screenSpace: true,
            scaleBlend: 0.5,
            scaleMode: pc.SCALEMODE_BLEND,
        });
        app.root.addChild(ui);
        const uiGroup = new pc.Entity('cam_ui_group');
        uiGroup.addComponent('element', {
            type: pc.ELEMENTTYPE_GROUP,
            anchor: new pc.Vec4(0.0, 0.0, 1.0, 1.0),
            margin: new pc.Vec4(0.0, 0.0, 0.0, 0.0),
            pivot: new pc.Vec2(0.0, 0.0), 
        });
        ui.addChild(uiGroup);

        const text = new pc.Entity('text');        
        var fontAsset = new pc.Asset('VarelaRound-Regular', "font", { url: "./VarelaRound-Regular.json" });
        fontAsset.on('load', function () {
            // Apply the font to the text element
            console.log("Font loaded");

            text.addComponent('element', {
                    pivot: new pc.Vec2(0.5, 0.5),
                    anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                    type: pc.ELEMENTTYPE_TEXT,
                    font: fontAsset.resource,
                    fontSize: 42,
                    text: "This is a new text element",
            });
            uiGroup.addChild(text);
        });
        app.assets.load(fontAsset);

        const uiBox = new pc.Entity('ui_box');
        uiBox.addComponent('element', {
            type: pc.ELEMENTTYPE_IMAGE,
            anchor: new pc.Vec4(1.0, 0.0, 1.0, 0.0),
            width: 300,
            height: 100,
            //margin: new pc.Vec4(0.0, 0.0, 0.0, 0.0),
            pivot: new pc.Vec2(1.0, 0.0), 
        });
        uiGroup.addChild(uiBox);

        // create camera entity
        const camera = new pc.Entity('camera');
        camera.addComponent('camera', {
            fov: 12,
            projection: 'Orthographic',
            orthoHeight: 2.5,
            clearColor: new pc.Color(0.01, 0.01, 0.01)
        });
        app.root.addChild(camera);
        camera.setPosition(0, 0, 3);

        // create directional light entity
        const light = new pc.Entity('light');
        light.addComponent('light');
        app.root.addChild(light);
        light.setEulerAngles(45, 0, 0);

        // rotate the box according to the delta time since the last frame
        //app.on('update', dt => plane.rotate(10 * dt, 20 * dt, 30 * dt));

        app.start();
    </script>
</body>
</html>